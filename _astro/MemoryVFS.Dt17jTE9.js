import{B as l}from"./VFS.CeCEg8FG.js";import{S as m,a as h,b as r,c as d,d as T}from"./sqlite-constants.C-WEsgk2.js";class u extends l{name="memory";mapNameToFile=new Map;mapIdToFile=new Map;constructor(){super()}close(){for(const e of this.mapIdToFile.keys())this.xClose(e)}xOpen(e,t,i,s){e=e||Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36);let n=this.mapNameToFile.get(e);if(!n)if(i&m)n={name:e,flags:i,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(e,n);else return h;return this.mapIdToFile.set(t,n),s.setInt32(0,i,!0),r}xClose(e){const t=this.mapIdToFile.get(e);return this.mapIdToFile.delete(e),t.flags&d&&this.mapNameToFile.delete(t.name),r}xRead(e,t,i){const s=this.mapIdToFile.get(e),n=Math.min(i,s.size),a=Math.min(i+t.byteLength,s.size)-n;return a&&t.set(new Uint8Array(s.data,n,a)),a<t.byteLength?(t.fill(0,a),T):r}xWrite(e,t,i){const s=this.mapIdToFile.get(e);if(i+t.byteLength>s.data.byteLength){const n=Math.max(i+t.byteLength,2*s.data.byteLength),o=new ArrayBuffer(n);new Uint8Array(o).set(new Uint8Array(s.data,0,s.size)),s.data=o}return new Uint8Array(s.data,i,t.byteLength).set(t),s.size=Math.max(s.size,i+t.byteLength),r}xTruncate(e,t){const i=this.mapIdToFile.get(e);return i.size=Math.min(i.size,t),r}xFileSize(e,t){const i=this.mapIdToFile.get(e);return t.setBigInt64(0,BigInt(i.size),!0),r}xDelete(e,t){return this.mapNameToFile.delete(e),r}xAccess(e,t,i){const s=this.mapNameToFile.get(e);return i.setInt32(0,s?1:0,!0),r}}export{u as MemoryVFS};
